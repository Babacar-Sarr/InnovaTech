{% extends "admin/base.html" %}
{% block title %}Admin | Tableau de bord{% endblock %}
{% block header %}Tableau de bord{% endblock %}
{% block content %}
<div class="row g-3">
  <div class="col-sm-6 col-lg-3">
    <div class="card shadow-sm"><div class="card-body d-flex justify-content-between">
      <div><div class="text-muted small text-uppercase">Produits</div><div class="fs-4 fw-bold">{{ total_products }}</div></div>
      <i class="fa-solid fa-box-open fa-2x text-primary"></i>
    </div></div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card shadow-sm"><div class="card-body d-flex justify-content-between">
      <div><div class="text-muted small text-uppercase">Commandes</div><div class="fs-4 fw-bold">{{ total_orders }}</div></div>
      <i class="fa-solid fa-basket-shopping fa-2x text-success"></i>
    </div></div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card shadow-sm"><div class="card-body d-flex justify-content-between">
      <div><div class="text-muted small text-uppercase">Utilisateurs</div><div class="fs-4 fw-bold">{{ total_users }}</div></div>
      <i class="fa-solid fa-users fa-2x text-info"></i>
    </div></div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card shadow-sm"><div class="card-body d-flex justify-content-between">
      <div><div class="text-muted small text-uppercase">Revenus</div><div class="fs-4 fw-bold">{{ revenue|floatformat:0 }} F</div></div>
      <i class="fa-solid fa-coins fa-2x text-warning"></i>
    </div></div>
  </div>
</div>

<div class="row g-3 mt-1">
  <div class="col-lg-7">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-white fw-semibold">Commandes (par jour)</div>
      <div class="card-body"><canvas id="ordersChart" height="120"></canvas></div>
    </div>
  </div>
  <div class="col-lg-5">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-white fw-semibold">Top produits</div>
      <div class="card-body">
        <ol class="mb-0">
          {% for p in top_products %}
            <li class="mb-1 d-flex justify-content-between">
              <span>{{ p.produit__nom }}</span><span class="text-muted">{{ p.qty }}</span>
            </li>
          {% empty %}<div class="text-muted">Aucune donnée.</div>{% endfor %}
        </ol>
      </div>
    </div>
  </div>
</div>

<div class="card shadow-sm mt-3">
  <div class="card-header bg-white fw-semibold">Dernières commandes</div>
  <div class="table-responsive">
    <table class="table align-middle mb-0">
      <thead><tr><th>#</th><th>Client</th><th>Date</th><th>Statut</th><th class="text-end">Total (F)</th></tr></thead>
      <tbody>
        {% for c in recent_orders %}
          <tr>
            <td>{{ c.id }}</td>
            <td>{{ c.user.get_full_name|default:c.user.username }}</td>
            <td>{{ c.date_commande|date:"d/m/Y H:i" }}</td>
            <td><span class="badge text-bg-light">{{ c.statut }}</span></td>
            <td class="text-end">{{ c.total|default:'—' }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="5" class="text-center text-muted py-4">Aucune commande.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const labels = {{ chart_days|safe }};
const counts = {{ chart_counts|safe }};
new Chart(document.getElementById('ordersChart'), {
  type: 'line',
  data: { labels, datasets: [{ data: counts, label: 'Commandes', borderColor:'#0d6efd', backgroundColor:'rgba(13,110,253,.1)', tension:.3, fill:true }]},
  options: { plugins:{legend:{display:false}}, scales:{ y:{ beginAtZero:true, ticks:{precision:0}}}}
});
</script>
{% endblock %}
